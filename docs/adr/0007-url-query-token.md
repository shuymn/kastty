# 0007: トークンを URL クエリパラメータで受け渡し

## Status

Proposed

## Context

kastty はセキュリティのために起動時ランダムトークンを生成し、HTTP / WS の双方で検証する。トークンをブラウザに渡す方法として以下の選択肢がある：

1. URL クエリパラメータ（`?t=<token>`）
2. 初回 HTML にトークンを埋め込み、WS 接続時に JS から送信
3. ハイブリッド（HTTP は URL クエリ、WS はプロトコル内で送信）

## Decision

**URL クエリパラメータ（`?t=<token>`）** でトークンを受け渡す。

- 起動時に `http://127.0.0.1:<port>/?t=<token>` を表示・ブラウザで開く
- HTTP リクエストと WS 接続の双方で同じクエリパラメータを使用する
- トークンはプロセス終了で失効する

## Consequences

### Positive

- 実装が最もシンプル
- ブラウザ自動起動でそのまま渡せる
- 静的ファイル配信のままで済む（テンプレートレンダリング不要）

### Negative

- ブラウザ履歴にトークンが残る（ただしプロセス終了で失効するため実害は低い）
- URL を誤って共有するとトークンも漏れる（localhost 用途なので外部からのアクセスは不可）

### Neutral

- URL にトークンが含まれることをユーザーに明示する（CLI 出力時）
- ログへのトークン出力はマスク表示とする
