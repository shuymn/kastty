# 0003: v1 では単一クライアント接続のみサポート

## Status

Proposed

## Context

kastty の主用途は MTG での画面共有であり、操作者は 1 名を想定している。複数クライアント接続をサポートするには、入力の競合制御やセッション共有の設計が必要となり、v1 の複雑度が増す。

## Decision

v1 では **同時接続は単一クライアントのみ** とする。既接続中に新規 WebSocket 接続が来た場合は拒否する。

ただし、`kastty` はブロッキングコマンドとして動作し PTY はプロセスに紐付くため（[ADR 0005](0005-blocking-command-pty-lifecycle.md)）、既存クライアントが切断した後は新規接続を受け入れる。これによりブラウザリロードでの再接続が可能になる。

## Consequences

### Positive

- 状態管理がシンプルになる（1 PTY : 1 クライアント）
- 入力競合の考慮が不要
- セキュリティ面でも攻撃面が限定される
- ブラウザリロードで再接続できるため、誤操作時のリカバリが容易

### Negative

- 将来のマルチビュー（操作ビュー + 観客ビュー）には接続ポリシーの拡張が必要

### Neutral

- 将来オプションとして「古い接続を切って新規接続を受け入れる」モードを検討する余地を残す
